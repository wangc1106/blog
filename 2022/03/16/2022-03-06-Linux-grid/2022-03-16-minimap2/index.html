<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="1osTo_gOe1SW9Hevqtz8vl8HfSgTO4DSMZ0DiMPMX6w">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangc1106.github.io","root":"/blog/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":"ture"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Minimap2 is a versatile sequence alignment program that aligns DNA or mRNA sequences against a large reference database.">
<meta property="og:type" content="article">
<meta property="og:title" content="【long reads mapping】【minimap2】">
<meta property="og:url" content="https://wangc1106.github.io/blog/2022/03/16/2022-03-06-Linux-grid/2022-03-16-minimap2/index.html">
<meta property="og:site_name" content="Banner&#39;s Blog">
<meta property="og:description" content="Minimap2 is a versatile sequence alignment program that aligns DNA or mRNA sequences against a large reference database.">
<meta property="og:locale">
<meta property="article:published_time" content="2022-03-16T12:47:36.697Z">
<meta property="article:modified_time" content="2022-03-19T14:17:14.096Z">
<meta property="article:author" content="Wang C">
<meta property="article:tag" content="denovo-III">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wangc1106.github.io/blog/2022/03/16/2022-03-06-Linux-grid/2022-03-16-minimap2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>【long reads mapping】【minimap2】 | Banner's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Banner's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Dream big work hard</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="https://wangc1106.github.io/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://wangc1106.github.io/blog/2022/03/16/2022-03-06-Linux-grid/2022-03-16-minimap2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/banner.png">
      <meta itemprop="name" content="Wang C">
      <meta itemprop="description" content="Make more time">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Banner's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【long reads mapping】【minimap2】
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-16 20:47:36" itemprop="dateCreated datePublished" datetime="2022-03-16T20:47:36+08:00">2022-03-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-19 22:17:14" itemprop="dateModified" datetime="2022-03-19T22:17:14+08:00">2022-03-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
            </span>

          
            <span id="/blog/2022/03/16/2022-03-06-Linux-grid/2022-03-16-minimap2/" class="post-meta-item leancloud_visitors" data-flag-title="【long reads mapping】【minimap2】" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>19 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Minimap2 is a versatile sequence alignment program that aligns DNA or mRNA sequences against a large reference database. </p>
<span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://github.com/lh3/minimap2">https://github.com/lh3/minimap2</a></p>
<ul>
<li>将PacBio或OXford Nanopore的read和已有参考基因组（如人类）进行比对(<strong>long reads mapping</strong>)</li>
<li>寻找高错误率read(15%)之间的overlap</li>
<li>将PacBio Iso-Seq 或Nanopore cDNA或RNA序列比对到参考基因组(splicing aware)</li>
<li>将<strong>illumina</strong> 单端或者双端序列比对到参考基因组</li>
<li><strong>组装之间</strong>的比对</li>
<li><strong>临近物种</strong>的全基因组比对</li>
</ul>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lh3/minimap2</span><br><span class="line"><span class="built_in">cd</span> minimap2 &amp;&amp; make</span><br><span class="line"><span class="comment"># long sequences against a reference genome</span></span><br><span class="line">./minimap2 -a <span class="built_in">test</span>/MT-human.fa <span class="built_in">test</span>/MT-orang.fa &gt; test.sam</span><br><span class="line"><span class="comment"># create an index first and then map</span></span><br><span class="line">./minimap2 -x map-ont -d MT-human-ont.mmi <span class="built_in">test</span>/MT-human.fa</span><br><span class="line">./minimap2 -a MT-human-ont.mmi <span class="built_in">test</span>/MT-orang.fa &gt; test.sam</span><br><span class="line"><span class="comment"># use presets (no test data)</span></span><br><span class="line">./minimap2 -ax map-pb ref.fa pacbio.fq.gz &gt; aln.sam       <span class="comment"># PacBio CLR genomic reads</span></span><br><span class="line">./minimap2 -ax map-ont ref.fa ont.fq.gz &gt; aln.sam         <span class="comment"># Oxford Nanopore genomic reads</span></span><br><span class="line">./minimap2 -ax map-hifi ref.fa pacbio-ccs.fq.gz &gt; aln.sam <span class="string">&#x27;PacBio HiFi/CCS genomic reads (v2.19 or later)&#x27;</span></span><br><span class="line">./minimap2 -ax asm20 ref.fa pacbio-ccs.fq.gz &gt; aln.sam    <span class="string">&#x27;PacBio HiFi/CCS genomic reads (v2.18 or earlier)&#x27;</span></span><br><span class="line">./minimap2 -ax sr ref.fa read1.fa read2.fa &gt; aln.sam      <span class="comment"># short genomic paired-end reads</span></span><br><span class="line">./minimap2 -ax splice ref.fa rna-reads.fa &gt; aln.sam       <span class="comment"># spliced long reads (strand unknown)</span></span><br><span class="line">./minimap2 -ax splice -uf -k14 ref.fa reads.fa &gt; aln.sam  <span class="comment"># noisy Nanopore Direct RNA-seq</span></span><br><span class="line">./minimap2 -ax splice:hq -uf ref.fa query.fa &gt; aln.sam    <span class="comment"># Final PacBio Iso-seq or traditional cDNA</span></span><br><span class="line">./minimap2 -ax splice --junc-bed anno.bed12 ref.fa query.fa &gt; aln.sam  <span class="comment"># prioritize on annotated junctions</span></span><br><span class="line">./minimap2 -cx asm5 asm1.fa asm2.fa &gt; aln.paf             <span class="string">&#x27;intra-species asm-to-asm alignment&#x27;</span></span><br><span class="line">./minimap2 -x ava-pb reads.fa reads.fa &gt; overlaps.paf     <span class="comment"># PacBio read overlap</span></span><br><span class="line">./minimap2 -x ava-ont reads.fa reads.fa &gt; overlaps.paf    <span class="comment"># Nanopore read overlap</span></span><br><span class="line"><span class="comment"># man page for detailed command line options</span></span><br><span class="line">man ./minimap2.1</span><br></pre></td></tr></table></figure>

<h2 id><a href="#" class="headerlink" title></a></h2><h2 id="Users’-Guide"><a href="#Users’-Guide" class="headerlink" title="Users’ Guide"></a>Users’ Guide</h2><p>Minimap2 is a versatile sequence alignment program that aligns <strong>DNA or mRNA</strong> sequences <strong>against</strong> a large <strong>reference</strong> database. </p>
<p>Typical use cases include: </p>
<p>(1) <strong>mapping PacBio</strong> or Oxford <strong>Nanopore</strong> genomic <strong>reads</strong> to the human genome;</p>
<p>(2) <strong>finding overlaps between long read</strong>s with <strong>error rate</strong> up to ~15%;</p>
<p>(3) <strong>splice-aware alignment</strong> of PacBio Iso-Seq or Nanopore cDNA or Direct RNA reads <strong>against</strong> a <strong>reference</strong> genome;</p>
<p>(4) aligning <strong>Illumina</strong> single- or paired-end reads; </p>
<p>(5) <strong>assembly-to-assembly alignment</strong>; </p>
<p>(6) <strong>full-genome alignment</strong> between <strong>two closely related species</strong> with <strong>divergence below ~15%</strong>.</p>
<p>For ~10kb noisy reads sequences, minimap2 is <strong>tens of times faster</strong> than mainstream long-read mappers such as BLASR, BWA-MEM, NGMLR and GMAP. It is <strong>more accurate</strong> on simulated long reads and produces biologically meaningful alignment ready for downstream analyses. For &gt;100bp <strong>Illumina short reads</strong>, minimap2 is <strong>three times</strong> as fast as <strong>BWA-MEM</strong> and <strong>Bowtie2</strong>, and as accurate on simulated data. Detailed evaluations are available from the <a target="_blank" rel="noopener" href="https://doi.org/10.1093/bioinformatics/bty191">minimap2 paper</a> or the <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1708.01492">preprint</a>.</p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd minimap2 &amp;&amp; make</span><br></pre></td></tr></table></figure>

<h3 id="PAF-a-Pairwise-mApping-Format"><a href="#PAF-a-Pairwise-mApping-Format" class="headerlink" title="PAF: a Pairwise mApping Format"></a>PAF: a Pairwise mApping Format</h3><p>PAF is a text format describing the <strong>approximate mapping positions</strong> between two set of sequences. PAF is TAB-delimited with each line consisting of the following predefined fields:</p>
<table>
<thead>
<tr>
<th>Col</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>string</td>
<td>Query sequence name</td>
</tr>
<tr>
<td>2</td>
<td>int</td>
<td>Query sequence length</td>
</tr>
<tr>
<td>3</td>
<td>int</td>
<td>Query start (0-based; BED-like; closed)</td>
</tr>
<tr>
<td>4</td>
<td>int</td>
<td>Query end (0-based; BED-like; open)</td>
</tr>
<tr>
<td>5</td>
<td>char</td>
<td>Relative strand: “+” or “-“</td>
</tr>
<tr>
<td>6</td>
<td>string</td>
<td>Target sequence name</td>
</tr>
<tr>
<td>7</td>
<td>int</td>
<td>Target sequence length</td>
</tr>
<tr>
<td>8</td>
<td>int</td>
<td>Target start on original strand (0-based)</td>
</tr>
<tr>
<td>9</td>
<td>int</td>
<td>Target end on original strand (0-based)</td>
</tr>
<tr>
<td>10</td>
<td>int</td>
<td>Number of residue matches</td>
</tr>
<tr>
<td>11</td>
<td>int</td>
<td>Alignment block length</td>
</tr>
<tr>
<td>12</td>
<td>int</td>
<td>Mapping quality (0-255; 255 for missing)</td>
</tr>
</tbody></table>
<p>If PAF is generated from an alignment, <strong>column 10 equals the number of sequence matches</strong>, and <strong>column 11 equals the total number of sequence matches, mismatches, insertions and deletions in the alignment</strong>. If alignment is not available, column 10 and 11 are still required but may be highly inaccurate.</p>
<p>A PAF file may optionally contain SAM-like typed key-value pairs at the end of each line.</p>
<h3 id="General-usage"><a href="#General-usage" class="headerlink" title="General usage"></a>General usage</h3><p>Without any options, minimap2 takes a <strong>reference</strong> database and a <strong>query sequence</strong> file as input and produce approximate mapping, without base-level alignment (i.e. coordinates are only approximate and no CIGAR in output), in the PAF format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimap2 ref.fa query.fq &gt; approx-mapping.paf</span><br></pre></td></tr></table></figure>

<p>You can ask minimap2 to generate CIGAR at the <code>cg</code> tag of PAF with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -c ref.fa query.fq &gt; alignment.paf</span><br></pre></td></tr></table></figure>

<p>or to output alignments in the <a target="_blank" rel="noopener" href="https://samtools.github.io/hts-specs/SAMv1.pdf">SAM format</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -a ref.fa query.fq &gt; alignment.sam</span><br></pre></td></tr></table></figure>

<p>Minimap2 seamlessly works with <strong>gzip’d FASTA</strong> and <strong>FASTQ</strong> formats as input. You <strong>don’t need to convert</strong> between FASTA and FASTQ or decompress gzip’d files first.</p>
<p>For the human reference genome, minimap2 takes a few minutes to generate a minimizer index for the reference before mapping. To <strong>reduce indexing time</strong>, you can optionally save the index with option <strong>-d</strong> and <strong>replace the reference sequence file with the index file</strong> on the minimap2 command line:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -d ref.mmi ref.fa                     # indexing</span><br><span class="line">minimap2 -a ref.mmi reads.fq &gt; alignment.sam   # alignment</span><br></pre></td></tr></table></figure>

<p><em><strong>Importantly</strong></em>, it should be noted that once you build the index, indexing parameters such as <strong>-k</strong>, <strong>-w</strong>, <strong>-H</strong> and <strong>-I</strong> can’t be changed during mapping. If you are running minimap2 for <strong>different data types</strong>, you will probably need to keep <strong>multiple indexes generated</strong> with different parameters. This makes minimap2 different from BWA which always uses the same index regardless of query data types.</p>
<h3 id="Use-cases"><a href="#Use-cases" class="headerlink" title="Use cases"></a>Use cases</h3><p>Minimap2 uses the same base algorithm for all applications. However, due to the different data types it supports (e.g. short vs long reads; DNA vs mRNA reads), minimap2 needs to be tuned for optimal performance and accuracy. It is usually recommended to choose a preset with option <strong>-x</strong>, which <strong>sets multiple parameters</strong> at the same time. The default setting is the same as <code>map-ont</code>.</p>
<h4 id="Map-long-noisy-genomic-reads"><a href="#Map-long-noisy-genomic-reads" class="headerlink" title="Map long noisy genomic reads"></a>Map long noisy genomic reads</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -ax map-pb  ref.fa pacbio-reads.fq &gt; aln.sam   <span class="comment"># for 【PacBio CLR】 reads</span></span><br><span class="line">minimap2 -ax map-ont ref.fa ont-reads.fq &gt; aln.sam      <span class="comment"># for 【Oxford Nanopore】 reads</span></span><br></pre></td></tr></table></figure>

<p>The difference between <code>map-pb</code> and <code>map-ont</code> is that <code>map-pb</code> uses homopolymer-compressed (HPC) minimizers as <strong>seeds</strong>, while <code>map-ont</code> uses ordinary minimizers as seeds. Emperical evaluation suggests HPC minimizers improve performance and sensitivity when aligning PacBio CLR reads, but hurt when aligning Nanopore reads.</p>
<h4 id="Map-long-mRNA-cDNA-reads"><a href="#Map-long-mRNA-cDNA-reads" class="headerlink" title="Map long mRNA/cDNA reads"></a>Map long mRNA/cDNA reads</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -ax splice:hq -uf ref.fa iso-seq.fq &gt; aln.sam       # PacBio Iso-seq/traditional cDNA</span><br><span class="line">minimap2 -ax splice ref.fa nanopore-cdna.fa &gt; aln.sam        # Nanopore 2D cDNA-seq</span><br><span class="line">minimap2 -ax splice -uf -k14 ref.fa direct-rna.fq &gt; aln.sam  # Nanopore Direct RNA-seq</span><br><span class="line">minimap2 -ax splice --splice-flank=no SIRV.fa SIRV-seq.fa    # mapping against SIRV control</span><br></pre></td></tr></table></figure>

<p>There are different long-read RNA-seq technologies, including tranditional full-length cDNA, EST, PacBio Iso-seq, Nanopore 2D cDNA-seq and Direct RNA-seq. They produce data of varying quality and properties. By default, <code>-x splice</code> <strong>assumes the read orientation relative to the transcript strand is unknown</strong>. It tries two rounds of alignment to infer the orientation and write the strand to the <code>ts</code> SAM/PAF tag if possible. For <strong>Iso-seq, Direct RNA-seq</strong> and tranditional full-length <strong>cDNAs</strong>, it would be desired to apply <code>-u f</code> to force minimap2 to <strong>consider the forward transcript strand only</strong>. This speeds up alignment with slight improvement to accuracy. For <strong>noisy Nanopore Direct RNA-seq reads</strong>, it is recommended to use a smaller k-mer size for increased sensitivity to the first or the last exons.</p>
<p>Minimap2 rates an alignment by the score of the max-scoring sub-segment, <em>excluding</em> introns, and marks the best alignment as primary in SAM. When a <strong>spliced gene also has unspliced pseudogenes</strong>, minimap2 does not intentionally prefer spliced alignment, though in practice it more often marks the spliced alignment as the primary. By default, minimap2 outputs up to five secondary alignments (i.e. likely pseudogenes in the context of RNA-seq mapping). This can be tuned with option <strong>-N</strong>.</p>
<p>For <strong>long RNA-seq reads</strong>, minimap2 may produce chimeric alignments potentially caused by gene fusions/structural variations or by an intron longer than the max intron length <strong>-G</strong> (200k by default). For now, it is not recommended to apply an excessively large <strong>-G</strong> as this slows down minimap2 and sometimes leads to false alignments.</p>
<p>It is worth noting that by default <code>-x splice</code> prefers GT[A/G]..[C/T]AG over GT[C/T]..[A/G]AG, and then over other splicing signals. Considering one additional base improves the junction accuracy for noisy reads, but reduces the accuracy when aligning against the widely used SIRV control data. This is because SIRV does not honor the evolutionarily conservative splicing signal. If you are studying <strong>SIRV</strong>, you may apply <code>--splice-flank=no</code> to let minimap2 only model GT..AG, ignoring the additional base.</p>
<p>Since v2.17, minimap2 can optionally <strong>take annotated genes as input</strong> and prioritize on annotated splice junctions. To use this feature, you can</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">paftools.js gff2bed anno.gff &gt; anno.bed</span><br><span class="line">minimap2 -ax splice --junc-bed anno.bed ref.fa query.fa &gt; aln.sam</span><br></pre></td></tr></table></figure>

<p>Here, <code>anno.gff</code> is the gene annotation in the GTF or GFF3 format (<code>gff2bed</code> automatically tests the format). The output of <code>gff2bed</code> is in the 12-column BED format, or the BED12 format. With the <code>--junc-bed</code> option, minimap2 adds a bonus score (tuned by <code>--junc-bonus</code>) if an aligned junction matches a junction in the annotation. Option <code>--junc-bed</code> also takes 5-column BED, including the strand field. In this case, each line indicates an oriented junction.</p>
<h4 id="Find-overlaps-between-long-reads"><a href="#Find-overlaps-between-long-reads" class="headerlink" title="Find overlaps between long reads"></a>Find overlaps between long reads</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -x ava-pb  reads.fq reads.fq &gt; ovlp.paf    # PacBio 【CLR read】 overlap</span><br><span class="line">minimap2 -x ava-ont reads.fq reads.fq &gt; ovlp.paf    # Oxford 【Nanopore read】 overlap</span><br></pre></td></tr></table></figure>

<p>Similarly, <code>ava-pb</code> uses HPC minimizers while <code>ava-ont</code> uses ordinary minimizers. It is usually not recommended to perform base-level alignment in the overlapping mode because it is slow and may produce false positive overlaps. However, if performance is not a concern, you may try to add <code>-a</code> or <code>-c</code> anyway.</p>
<h4 id="Map-short-accurate-genomic-reads"><a href="#Map-short-accurate-genomic-reads" class="headerlink" title="Map short accurate genomic reads"></a>Map short accurate genomic reads</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -ax sr ref.fa reads-se.fq &gt; aln.sam           # single-end alignment</span><br><span class="line">minimap2 -ax sr ref.fa read1.fq read2.fq &gt; aln.sam     # paired-end alignment</span><br><span class="line">minimap2 -ax sr ref.fa reads-interleaved.fq &gt; aln.sam  # paired-end alignment</span><br></pre></td></tr></table></figure>

<p>When two read files are specified, minimap2 reads from each file in turn and merge them into an interleaved stream internally. Two reads are considered to be paired if they are adjacent in the input stream and have the same name (with the <code>/[0-9]</code> suffix trimmed if present). Single- and paired-end reads can be mixed.</p>
<p>Minimap2 <strong>does not work well with short spliced reads</strong>. There are many capable RNA-seq mappers for short reads.</p>
<h4 id="Full-genome-assembly-alignment"><a href="#Full-genome-assembly-alignment" class="headerlink" title="Full genome/assembly alignment"></a><font color="blue">Full genome/assembly alignment</font></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -ax asm5 ref.fa asm.fa &gt; aln.sam       # assembly to assembly/ref alignment</span><br></pre></td></tr></table></figure>

<p>For <strong>cross-species</strong> full-genome alignment, the scoring system needs to be tuned according to the sequence divergence.</p>
<h3 id="Advanced-features"><a href="#Advanced-features" class="headerlink" title="Advanced features"></a>Advanced features</h3><h4 id="Working-with-gt-65535-CIGAR-operations"><a href="#Working-with-gt-65535-CIGAR-operations" class="headerlink" title="Working with &gt;65535 CIGAR operations"></a>Working with &gt;65535 CIGAR operations</h4><p>Due to a design flaw, BAM does not work with CIGAR strings with &gt;65535 operations (SAM and CRAM work). However, for <strong>ultra-long nanopore reads</strong> minimap2 may align ~1% of read bases with long CIGARs beyond the capability of BAM. If you convert such SAM/CRAM to BAM, Picard and recent samtools will throw an error and abort. Older samtools and other tools may create corrupted BAM.</p>
<p>To avoid this issue, you can add option <code>-L</code> at the minimap2 command line. This option moves a long CIGAR to the <code>CG</code> tag and leaves a fully clipped CIGAR at the SAM CIGAR column. Current tools that don’t read CIGAR (e.g. merging and sorting) still work with such BAM records; tools that read CIGAR will effectively ignore these records. It has been decided that future tools will seamlessly recognize long-cigar records generated by option <code>-L</code>.</p>
<p><strong>TL;DR</strong>: if you work with ultra-long reads and use tools that only process BAM files, please add option <code>-L</code>.</p>
<h4 id="The-cs-optional-tag"><a href="#The-cs-optional-tag" class="headerlink" title="The cs optional tag"></a>The cs optional tag</h4><p>The <code>cs</code> SAM/PAF tag encodes bases at mismatches and INDELs. It matches regular expression <code>/(:[0-9]+|\*[a-z][a-z]|[=\+\-][A-Za-z]+)+/</code>. Like CIGAR, <code>cs</code> consists of series of operations. Each leading character specifies the operation; the following sequence is the one involved in the operation.</p>
<p>The <code>cs</code> tag is enabled by command line option <code>--cs</code>. The following alignment, for example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CGATCGATAAATAGAGTAG---GAATAGCA</span><br><span class="line">||||||   ||||||||||   |||| |||</span><br><span class="line">CGATCG---AATAGAGTAGGTCGAATtGCA</span><br></pre></td></tr></table></figure>

<p>is represented as <code>:6-ata:10+gtc:4*at:3</code>, where <code>:[0-9]+</code> represents an identical block, <code>-ata</code> represents a deletion, <code>+gtc</code> an insertion and <code>*at</code> indicates reference base <code>a</code> is substituted with a query base <code>t</code>. It is similar to the <code>MD</code> SAM tag but is standalone and easier to parse.</p>
<p>If <code>--cs=long</code> is used, the <code>cs</code> string also contains identical sequences in the alignment. The above example will become <code>=CGATCG-ata=AATAGAGTAG+gtc=GAAT*at=GCA</code>. The long form of <code>cs</code> <strong>encodes both reference and query sequences in one string</strong>. The <code>cs</code> tag also encodes <strong>intron positions</strong> and <strong>splicing signals</strong> (see the <a target="_blank" rel="noopener" href="https://lh3.github.io/minimap2/minimap2.html#10">minimap2 manpage</a> for details).</p>
<h4 id="Working-with-the-PAF-format"><a href="#Working-with-the-PAF-format" class="headerlink" title="Working with the PAF format"></a><font color="red">Working with the PAF format</font></h4><p>Minimap2 also comes with a (java)script <a target="_blank" rel="noopener" href="https://github.com/lh3/minimap2/blob/master/misc/paftools.js">paftools.js</a> that processes alignments in the PAF format. It calls variants from assembly-to-reference alignment, lifts over BED files based on alignment, converts between formats and provides utilities for various evaluations. For details, please see <a target="_blank" rel="noopener" href="https://github.com/lh3/minimap2/blob/master/misc/README.md">misc/README.md</a>.</p>
<h3 id="Algorithm-overview"><a href="#Algorithm-overview" class="headerlink" title="Algorithm overview"></a>Algorithm overview</h3><p>In the following, minimap2 command line options have a dash ahead and are highlighted in bold. The description may help to tune minimap2 parameters.</p>
<ol>
<li>Read <strong>-I</strong> [=<em>4G</em>] reference bases, extract (<strong>-k</strong>,<strong>-w</strong>)-minimizers and index them in a hash table.</li>
<li>Read <strong>-K</strong> [=<em>200M</em>] query bases. For each query sequence, do step 3 through 7:</li>
<li>For each (<strong>-k</strong>,<strong>-w</strong>)-minimizer on the query, check against the reference index. If a reference minimizer is not among the top <strong>-f</strong> [=<em>2e-4</em>] most frequent, collect its the occurrences in the reference, which are called <em>seeds</em>.</li>
<li>Sort seeds by position in the reference. Chain them with dynamic programming. Each chain represents a potential mapping. For read overlapping, report all chains and then go to step 8. For reference mapping, do step 5 through 7:</li>
<li>Let <em>P</em> be the set of primary mappings, which is an empty set initially. For each chain from the best to the worst according to their chaining scores: if on the query, the chain overlaps with a chain in <em>P</em> by <strong>–mask-level</strong> [=<em>0.5</em>] or higher fraction of the shorter chain, mark the chain as <em>secondary</em> to the chain in <em>P</em>; otherwise, add the chain to <em>P</em>.</li>
<li>Retain all primary mappings. Also retain up to <strong>-N</strong> [=<em>5</em>] top secondary mappings if their chaining scores are higher than <strong>-p</strong> [=<em>0.8</em>] of their corresponding primary mappings.</li>
<li>If alignment is requested, filter out an internal seed if it potentially leads to both a long insertion and a long deletion. Extend from the left-most seed. Perform global alignments between internal seeds. Split the chain if the accumulative score along the global alignment drops by <strong>-z</strong> [=<em>400</em>], disregarding long gaps. Extend from the right-most seed. Output chains and their alignments.</li>
<li>If there are more query sequences in the input, go to step 2 until no more queries are left.</li>
<li>If there are more reference sequences, reopen the query file from the start and go to step 1; otherwise stop.</li>
</ol>
<h3 id="Getting-help"><a href="#Getting-help" class="headerlink" title="Getting help"></a>Getting help</h3><p>Manpage <a target="_blank" rel="noopener" href="https://lh3.github.io/minimap2/minimap2.html">minimap2.1</a> provides detailed description of minimap2 command line options and optional tags. The <a target="_blank" rel="noopener" href="https://github.com/lh3/minimap2/blob/master/FAQ.md">FAQ</a>page answers several frequently asked questions. If you encounter bugs or have further questions or requests, you can raise an issue at the <a target="_blank" rel="noopener" href="https://github.com/lh3/minimap2/issues">issue page</a>. There is not a specific mailing list for the time being.</p>
<h2 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h2><ul>
<li>Minimap2 may produce <strong>suboptimal alignments</strong> through <strong>long low-complexity regions</strong> where seed positions may be suboptimal. This should not be a big concern because even the optimal alignment may be wrong in such regions.</li>
<li>Minimap2 requires SSE2 instructions on x86 CPUs or NEON on ARM CPUs. It is possible to add non-SIMD support, but it would make minimap2 slower by several times.</li>
<li>Minimap2 <strong>does not work</strong> with a single query or database sequence ~<strong>2 billion bases or longer</strong> (2,147,483,647 to be exact). The total length of all sequences can well exceed this threshold.</li>
<li>Minimap2 often <strong>misses small exons</strong>.</li>
</ul>
<h2 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h2><p>Minimap2 follows a typical <strong>seed-chain-align procedure</strong> as is used by most full-genome aligners. It <strong>collects minimizers</strong> (Roberts <em>et al</em>., 2004) of the <strong>reference sequences</strong> and <strong>indexes them in a hash table</strong>, with the <strong>key</strong> being the hash of a minimizer and the <strong>value</strong> being a list of locations of the minimizer copies. Then for <strong>each query sequence</strong>, minimap2 takes query minimizers as <em>seeds</em>, finds exact matches (i.e. <em>anchors</em>) to the reference, and identifies sets of colinear anchors as <em>chains</em>. If base-level alignment is requested, minimap2 applies <strong>dynamic programming</strong> (DP) to extend from the ends of chains and to close regions between adjacent anchors in chains.</p>
<p>Minimap2 uses indexing and seeding algorithms similar to minimap (Li, 2016), and furthers the predecessor with more accurate chaining, the ability to produce base-level alignment and the support of spliced alignment.</p>
<h1 id="asm-vs-asm"><a href="#asm-vs-asm" class="headerlink" title="asm vs asm"></a>asm vs asm</h1><h2 id="Difference-of-SNP-amp-indel-between-asm-vs-asm"><a href="#Difference-of-SNP-amp-indel-between-asm-vs-asm" class="headerlink" title="Difference of SNP&amp;indel between asm vs asm"></a>Difference of SNP&amp;indel between asm vs asm</h2><p><a target="_blank" rel="noopener" href="https://bleepcoder.com/cn/minimap2/296555096/a-best-practices-document-for-assembly-to-assembly">ref</a></p>
<p><code>paftools.js call</code>现在支持 VCF 输出。 要使用它，请将<code>-f ref.fa</code>加到命令行中：</p>
<p>对同一物种的asm使用<code>asm5</code> 。 如果略有不同，请使用<code>asm10</code> 。 如果序列差异很大，请使用<code>-a</code> 。</p>
<p>variant calling</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lh3/minimap2   <span class="comment"># you need the latest version; not from conda</span></span><br><span class="line"><span class="built_in">cd</span> minimap2 &amp;&amp; make</span><br><span class="line"></span><br><span class="line">curl -L https://github.com/attractivechaos/k8/releases/download/v0.2.4/k8-0.2.4.tar.bz2 | tar -jxf -</span><br><span class="line">cp k8-0.2.4/k8-`uname -s` k8   <span class="comment"># or copy it to a directory on you $PATH</span></span><br><span class="line"></span><br><span class="line">./minimap2 -c --cs ref.fa query.fa \</span><br><span class="line">  | sort -k6,6 -k8,8n \</span><br><span class="line">  | ./k8 misc/paftools.js call -f ref.fa -L20000 - &gt; var.vcf</span><br></pre></td></tr></table></figure>

<p>两asm差异太大。 可以先尝试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./minimap2 -c --cs ref.fa query.fa | sort -k6,6 -k8,8n | ./k8 misc/paftools.js call -L20000 - &gt; var.txt</span><br></pre></td></tr></table></figure>

<p>生成vcf方法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lh3/htsbox</span><br><span class="line">(<span class="built_in">cd</span> htsbox &amp;&amp; make)</span><br><span class="line">minimap2 -axasm5 wt_minion.fasta wt_pacbio.fasta | samtool sort - &gt; sorted.bam</span><br><span class="line">htsbox/htsbox pileup -q5 -S10000 -vcf wt_minion.fasta sorted.bam &gt; diff.vcf</span><br></pre></td></tr></table></figure>

<h2 id="convert-sam-asm-vs-asm-to-paf"><a href="#convert-sam-asm-vs-asm-to-paf" class="headerlink" title="convert sam(asm vs asm) to paf"></a>convert sam(asm vs asm) to paf</h2><p><a target="_blank" rel="noopener" href="https://www.biostars.org/p/479287/">ref</a></p>
<p>Looks like no one has actually read the question correctly. <font color="blue"><strong>PAF is missing lots of information compared to SAM</strong></font>, because it is <font color="blue"><strong>a summary of alignment</strong></font>, but it also has <font color="blue">easy access to the <strong>alignment start</strong> and <strong>stop coordinates</strong>, <strong>sequences length</strong></font>, etc. Since <font color="blue">PAF is less information-dense you <strong>cannot convert in both directions</strong></font>.</p>
<p>There are several options:</p>
<ol>
<li>Use Heng Li’s experimental toolkit, <font color="blue">htsbox samview -p in.bam</font>: <a target="_blank" rel="noopener" href="https://github.com/lh3/htsbox">https://github.com/lh3/htsbox</a></li>
<li>Use <font color="green"><strong>paftools.js sam2paf</strong></font>: <a target="_blank" rel="noopener" href="https://github.com/lh3/minimap2/blob/master/misc/README.md#introduction">https://github.com/lh3/minimap2/blob/master/misc/README.md#introduction</a></li>
<li>Use this <font color="blue">python</font> library: <a target="_blank" rel="noopener" href="https://bioconvert.readthedocs.io/en/master/_modules/bioconvert/sam2paf.html">https://bioconvert.readthedocs.io/en/master/_modules/bioconvert/sam2paf.html</a></li>
</ol>
<h2 id="visualization-of-PAF-file-obtained-from-asm-vs-asm-in-minimap2"><a href="#visualization-of-PAF-file-obtained-from-asm-vs-asm-in-minimap2" class="headerlink" title="visualization of PAF file obtained from asm_vs_asm in minimap2"></a>visualization of PAF file obtained from asm_vs_asm in minimap2</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/befb3a440aed">Ref</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source(<span class="string">&quot;.paf.R&quot;</span>)</span><br><span class="line">df &lt;- read.paf(<span class="string">&quot;./asm_vs_ref.paf&quot;</span>)</span><br><span class="line">plot_synteny(df)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>grid系统里面的视图(viewport)可以继续分为多个图层，每个图层可有不同的坐标系统。</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">read.paf &lt;- <span class="keyword">function</span>(file, sep = <span class="string">&quot;\t&quot;</span>,</span><br><span class="line">                     header = <span class="literal">FALSE</span>,</span><br><span class="line">                     MQ = <span class="number">10</span>,</span><br><span class="line">                     ...)&#123;</span><br><span class="line">  data &lt;- readLines(file)</span><br><span class="line">  </span><br><span class="line">  dataSize &lt;- <span class="built_in">length</span>(data)</span><br><span class="line">  <span class="comment"># initialize </span></span><br><span class="line">  qName   &lt;- vector(<span class="string">&quot;character&quot;</span>, dataSize)</span><br><span class="line">  qLength &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  qStart  &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  qEnd    &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  strand  &lt;- vector(<span class="string">&quot;character&quot;</span>, dataSize)</span><br><span class="line">  tName   &lt;- vector(<span class="string">&quot;character&quot;</span>, dataSize)</span><br><span class="line">  tLength &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  tStart  &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  tEnd    &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  reMatch &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  bLength &lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line">  mQuality&lt;- vector(<span class="string">&quot;integer&quot;</span>, dataSize)</span><br><span class="line"></span><br><span class="line">  i &lt;- 1</span><br><span class="line">  j &lt;- 0</span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> seq(dataSize))&#123;</span><br><span class="line">    items   &lt;- strsplit(data[i], split = sep)[[<span class="number">1</span>]]</span><br><span class="line">    </span><br><span class="line">    quality &lt;- <span class="built_in">as.numeric</span>(items[<span class="number">12</span>]) <span class="comment">#Mapping Quality 0-255</span></span><br><span class="line">    <span class="keyword">if</span> (quality &lt; MQ)</span><br><span class="line">      <span class="keyword">next</span></span><br><span class="line">    j &lt;- j + <span class="number">1</span></span><br><span class="line">    qName[j]   &lt;- items[<span class="number">1</span>] <span class="comment"># Query sequence name</span></span><br><span class="line">    qLength[j] &lt;- <span class="built_in">as.integer</span>(items[<span class="number">2</span>])</span><br><span class="line">    qStart[j]  &lt;- <span class="built_in">as.integer</span>(items[<span class="number">3</span>]) + <span class="number">1L</span></span><br><span class="line">    qEnd[j]    &lt;- <span class="built_in">as.integer</span>(items[<span class="number">4</span>]) + <span class="number">1L</span> <span class="comment"># convert 0-based to 1-based</span></span><br><span class="line">    strand[j]  &lt;- items[<span class="number">5</span>] <span class="comment"># Relative strand: &quot;+&quot; or &quot;-&quot;</span></span><br><span class="line">    tName[j]   &lt;- items[<span class="number">6</span>] <span class="comment"># Target sequence name</span></span><br><span class="line">    tLength[j] &lt;- <span class="built_in">as.integer</span>(items[<span class="number">7</span>])</span><br><span class="line">    tStart[j]  &lt;- <span class="built_in">as.integer</span>(items[<span class="number">8</span>]) + <span class="number">1L</span></span><br><span class="line">    tEnd[j]    &lt;- <span class="built_in">as.integer</span>(items[<span class="number">9</span>]) + <span class="number">1L</span></span><br><span class="line">    reMatch[j] &lt;- <span class="built_in">as.integer</span>(items[<span class="number">10</span>])  <span class="comment">#Number of residue matches</span></span><br><span class="line">    bLength[j] &lt;- <span class="built_in">as.integer</span>(items[<span class="number">11</span>]) <span class="comment">#Alignment block length</span></span><br><span class="line">    mQuality[j]&lt;- <span class="built_in">as.integer</span>(items[<span class="number">12</span>]) <span class="comment">#Alignment block length</span></span><br><span class="line">  &#125; </span><br><span class="line">    pafDataframe &lt;- data.frame(qName = qName[<span class="number">1</span>:j], qStart = qStart[<span class="number">1</span>:j], qEnd = qEnd[<span class="number">1</span>:j],</span><br><span class="line">                               tName = tName[<span class="number">1</span>:j], tStart = tStart[<span class="number">1</span>:j], tEnd = tEnd[<span class="number">1</span>:j],</span><br><span class="line">                               qLength = qLength[<span class="number">1</span>:j], tLength = tLength[<span class="number">1</span>:j], </span><br><span class="line">                               strand  = strand[<span class="number">1</span>:j],</span><br><span class="line">                               reMatch = reMatch[<span class="number">1</span>:j], bLength = bLength[<span class="number">1</span>:j],</span><br><span class="line">                               mQuality = mQuality[<span class="number">1</span>:j],</span><br><span class="line">                               stringsAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line">  <span class="built_in">return</span>(pafDataframe) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plot_synteny &lt;- <span class="keyword">function</span>(df, contigs = <span class="number">20</span>,</span><br><span class="line">                         lineSize = <span class="number">3</span>,</span><br><span class="line">                         borderCol = <span class="string">&quot;#5496ff&quot;</span>,... )&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># select the top N contig</span></span><br><span class="line">  x &lt;- df[,<span class="built_in">c</span>(<span class="string">&quot;qName&quot;</span>,<span class="string">&quot;qLength&quot;</span>)]</span><br><span class="line">  x &lt;- x[!duplicated(x$qName),]</span><br><span class="line">  x &lt;- x[order(x$qLength, decreasing = <span class="literal">TRUE</span>),][<span class="number">1</span>:contigs,]</span><br><span class="line"></span><br><span class="line">  y &lt;- df[,<span class="built_in">c</span>(<span class="string">&quot;tName&quot;</span>,<span class="string">&quot;tLength&quot;</span>)]</span><br><span class="line">  y &lt;- y[!duplicated(y$tName),]</span><br><span class="line">  y &lt;- y[order(y$tLength, decreasing = <span class="literal">TRUE</span>),][<span class="number">1</span>:contigs,]</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># make new page for ploting</span></span><br><span class="line">  grid::grid.newpage()</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># allot the ratio of each contig</span></span><br><span class="line">  x_frac &lt;- x$qLength / <span class="built_in">sum</span>(x$qLength)</span><br><span class="line">  y_frac &lt;- y$tLength / <span class="built_in">sum</span>(y$tLength)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># draw the contig name</span></span><br><span class="line">  grid::pushViewport(grid::viewport(height = <span class="number">0.7</span>,</span><br><span class="line">                        width =  <span class="number">0.7</span>,</span><br><span class="line">                        gp = grid::gpar(cex = <span class="number">0.75</span>),</span><br><span class="line">                        name = <span class="string">&quot;contigName&quot;</span>))</span><br><span class="line">  x_pos &lt;- <span class="built_in">c</span>(<span class="number">0</span>, <span class="built_in">cumsum</span>(x_frac)[<span class="number">1</span>:(contigs-<span class="number">1</span>)])</span><br><span class="line">  y_pos &lt;- 1- <span class="built_in">c</span>(<span class="number">0</span>, <span class="built_in">cumsum</span>(y_frac)[<span class="number">1</span>:(contigs-<span class="number">1</span>)])</span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="built_in">seq.int</span>(<span class="number">1</span>,contigs))&#123;</span><br><span class="line">    grid::grid.text(label = x[i,<span class="number">1</span>], </span><br><span class="line">              x = grid::unit(x_pos[i], <span class="string">&quot;npc&quot;</span>),</span><br><span class="line">              y = grid::unit(<span class="number">1</span>, <span class="string">&quot;npc&quot;</span>),</span><br><span class="line">              just = <span class="built_in">c</span>(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;bottom&quot;</span>),</span><br><span class="line">              rot = <span class="number">35</span></span><br><span class="line">              )</span><br><span class="line">    grid::grid.text(label = y[i, <span class="number">1</span>],</span><br><span class="line">              x = grid::unit(<span class="number">1</span>, <span class="string">&quot;npc&quot;</span>),</span><br><span class="line">              y = grid::unit(y_pos[i], <span class="string">&quot;npc&quot;</span>),</span><br><span class="line">              just = <span class="built_in">c</span>(<span class="string">&quot;left&quot;</span>)</span><br><span class="line">              )</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  vplay &lt;- grid::grid.layout(contigs, contigs, </span><br><span class="line">                       widths  = x_frac,</span><br><span class="line">                       heights = y_frac)</span><br><span class="line">  grid::pushViewport(grid::viewport(layout = vplay,</span><br><span class="line">                        name = <span class="string">&quot;vplay&quot;</span>))</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment"># line represent the synteny</span></span><br><span class="line">  <span class="keyword">for</span> ( i <span class="keyword">in</span> seq(<span class="number">1</span>, contigs))&#123;</span><br><span class="line">    <span class="keyword">for</span> (j <span class="keyword">in</span> seq(<span class="number">1</span>, contigs))&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment"># get the name and length for subsetting</span></span><br><span class="line">      xName   &lt;- x[i,<span class="number">1</span>]</span><br><span class="line">      xLength &lt;- x[i,<span class="number">2</span>]</span><br><span class="line">      yName   &lt;- y[j,<span class="number">1</span>] </span><br><span class="line">      yLength &lt;- y[j,<span class="number">2</span>]</span><br><span class="line">      </span><br><span class="line">      <span class="comment"># push view port for plot Collinearity</span></span><br><span class="line">      grid::pushViewport(grid::viewport(layout.pos.col = i,</span><br><span class="line">                            layout.pos.row = j,</span><br><span class="line">                            xscale = <span class="built_in">c</span>(<span class="number">1</span>, xLength),</span><br><span class="line">                            yscale = <span class="built_in">c</span>(<span class="number">1</span>, yLength),</span><br><span class="line">                            name = paste0(<span class="string">&quot;pos&quot;</span>,i,j)))</span><br><span class="line">  </span><br><span class="line">      grid::grid.rect(gp=grid::gpar(col=borderCol))</span><br><span class="line">      <span class="comment"># select the data</span></span><br><span class="line">      plot_df &lt;- df[df$qName == xName &amp; df$tName == yName,] </span><br><span class="line">      blocks &lt;- nrow(plot_df)</span><br><span class="line">      <span class="comment">#cat(sprintf(&quot;block size is %d\n&quot;, blocks))</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (blocks == <span class="number">0</span>) &#123;</span><br><span class="line">        grid::upViewport() </span><br><span class="line">        <span class="keyword">next</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment"># plot the line</span></span><br><span class="line">      <span class="keyword">for</span> (k <span class="keyword">in</span> seq(<span class="number">1</span>, blocks))&#123;</span><br><span class="line">        <span class="keyword">if</span> (plot_df$strand[k] == <span class="string">&quot;+&quot;</span>)&#123;</span><br><span class="line">          grid::grid.lines(x = <span class="built_in">c</span>(plot_df$qStart[k], plot_df$qEnd[k]),</span><br><span class="line">                     y = <span class="built_in">c</span>(plot_df$tStart[k], plot_df$tEnd[k]),</span><br><span class="line">                     gp=grid::gpar(lwd = lineSize),</span><br><span class="line">                     default.units = <span class="string">&quot;native&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          grid::grid.lines(x = <span class="built_in">c</span>(plot_df$qStart[k], plot_df$qEnd[k]),</span><br><span class="line">                     y = <span class="built_in">c</span>(plot_df$tEnd[k], plot_df$tStart[k]),</span><br><span class="line">                     gp=grid::gpar(lwd = lineSize),</span><br><span class="line">                     default.units = <span class="string">&quot;native&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      grid::upViewport() </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Wang C
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://wangc1106.github.io/blog/2022/03/16/2022-03-06-Linux-grid/2022-03-16-minimap2/" title="【long reads mapping】【minimap2】">https://wangc1106.github.io/blog/2022/03/16/2022-03-06-Linux-grid/2022-03-16-minimap2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/denovo-III/" rel="tag"># denovo-III</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2022/03/16/2022-03-16-HiFi-7-HiC-assembly2/" rel="prev" title="HiFi-7-[HiFi+HiC-assembly-method]">
      <i class="fa fa-chevron-left"></i> HiFi-7-[HiFi+HiC-assembly-method]
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2022/03/16/2022-03-16-juicer/" rel="next" title="【Hi-C】【Juicer】">
      【Hi-C】【Juicer】 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting-Started"><span class="nav-number">1.</span> <span class="nav-text">Getting Started</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Users%E2%80%99-Guide"><span class="nav-number">3.</span> <span class="nav-text">Users’ Guide</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Installation"><span class="nav-number">3.1.</span> <span class="nav-text">Installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PAF-a-Pairwise-mApping-Format"><span class="nav-number">3.2.</span> <span class="nav-text">PAF: a Pairwise mApping Format</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#General-usage"><span class="nav-number">3.3.</span> <span class="nav-text">General usage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-cases"><span class="nav-number">3.4.</span> <span class="nav-text">Use cases</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Map-long-noisy-genomic-reads"><span class="nav-number">3.4.1.</span> <span class="nav-text">Map long noisy genomic reads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map-long-mRNA-cDNA-reads"><span class="nav-number">3.4.2.</span> <span class="nav-text">Map long mRNA&#x2F;cDNA reads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Find-overlaps-between-long-reads"><span class="nav-number">3.4.3.</span> <span class="nav-text">Find overlaps between long reads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map-short-accurate-genomic-reads"><span class="nav-number">3.4.4.</span> <span class="nav-text">Map short accurate genomic reads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Full-genome-assembly-alignment"><span class="nav-number">3.4.5.</span> <span class="nav-text">Full genome&#x2F;assembly alignment</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-features"><span class="nav-number">3.5.</span> <span class="nav-text">Advanced features</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Working-with-gt-65535-CIGAR-operations"><span class="nav-number">3.5.1.</span> <span class="nav-text">Working with &gt;65535 CIGAR operations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-cs-optional-tag"><span class="nav-number">3.5.2.</span> <span class="nav-text">The cs optional tag</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Working-with-the-PAF-format"><span class="nav-number">3.5.3.</span> <span class="nav-text">Working with the PAF format</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Algorithm-overview"><span class="nav-number">3.6.</span> <span class="nav-text">Algorithm overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getting-help"><span class="nav-number">3.7.</span> <span class="nav-text">Getting help</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Limitations"><span class="nav-number">4.</span> <span class="nav-text">Limitations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#methods"><span class="nav-number">5.</span> <span class="nav-text">methods</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#asm-vs-asm"><span class="nav-number"></span> <span class="nav-text">asm vs asm</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Difference-of-SNP-amp-indel-between-asm-vs-asm"><span class="nav-number">1.</span> <span class="nav-text">Difference of SNP&amp;indel between asm vs asm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#convert-sam-asm-vs-asm-to-paf"><span class="nav-number">2.</span> <span class="nav-text">convert sam(asm vs asm) to paf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visualization-of-PAF-file-obtained-from-asm-vs-asm-in-minimap2"><span class="nav-number">3.</span> <span class="nav-text">visualization of PAF file obtained from asm_vs_asm in minimap2</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wang C"
      src="/blog/images/banner.png">
  <p class="site-author-name" itemprop="name">Wang C</p>
  <div class="site-description" itemprop="description">Make more time</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangc1106" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangc1106" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangchen116@126.com" title="E-Mail → mailto:wangchen116@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fas fa-dna"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang C</span>
</div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"UqIYufmNk2sE8MiBKKWc4Kja-gzGzoHsz","app_key":"iYpeWQcmNqpHwr2uVlnJYVji","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
      <div style="height: 200px">
      <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5knf34gs07t&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"></script>
      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
