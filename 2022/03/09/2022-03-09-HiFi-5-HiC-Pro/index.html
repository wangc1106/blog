<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="1osTo_gOe1SW9Hevqtz8vl8HfSgTO4DSMZ0DiMPMX6w">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangc1106.github.io","root":"/blog/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":"ture"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="HiC-Pro将fq文件处理成互作allValidPairs，再转化成可视化hic文件(for juicer)">
<meta property="og:type" content="article">
<meta property="og:title" content="HiFi-5-[HiC-Pro]-[MCscan]-[ALLHiC]">
<meta property="og:url" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/index.html">
<meta property="og:site_name" content="Banner&#39;s Blog">
<meta property="og:description" content="HiC-Pro将fq文件处理成互作allValidPairs，再转化成可视化hic文件(for juicer)">
<meta property="og:locale">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/5.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/6.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/7.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/8.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/1.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/2.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/3.png">
<meta property="og:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/4.png">
<meta property="article:published_time" content="2022-03-09T07:39:23.398Z">
<meta property="article:modified_time" content="2022-03-09T14:56:47.778Z">
<meta property="article:author" content="Wang C">
<meta property="article:tag" content="denovo-III">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/5.png">

<link rel="canonical" href="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>HiFi-5-[HiC-Pro]-[MCscan]-[ALLHiC] | Banner's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Banner's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Dream big work hard</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="https://wangc1106.github.io/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/banner.png">
      <meta itemprop="name" content="Wang C">
      <meta itemprop="description" content="Make more time">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Banner's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HiFi-5-[HiC-Pro]-[MCscan]-[ALLHiC]
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-09 15:39:23 / Modified: 22:56:47" itemprop="dateCreated datePublished" datetime="2022-03-09T15:39:23+08:00">2022-03-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
                </span>
            </span>

          
            <span id="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/" class="post-meta-item leancloud_visitors" data-flag-title="HiFi-5-[HiC-Pro]-[MCscan]-[ALLHiC]" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>HiC-Pro将fq文件处理成互作allValidPairs，再转化成可视化hic文件(for juicer)</p>
<span id="more"></span>

<h1 id="HiC简介"><a href="#HiC简介" class="headerlink" title="HiC简介"></a>HiC简介</h1><ul>
<li><p><strong>1.1 Hi-C技术</strong>高通量染色体构象捕获技术(<code>High-throughput chromosome conformation capture</code>)研究全基因组三维构象及分析染色质片段相互作用的实验技术</p>
</li>
<li><p><strong>1.2 Hi-C目的</strong>了解核内染色质的三维构象、获得细胞核内空间位置非常接近或存在相互作用的染色质测序片段更好地研究染色质内或染色质间的互作、基因调控元件在全基因组范围内调控的情况</p>
</li>
<li><p><strong>1.3 Hi-C应用方向</strong>辅助基因组组装、揭示空间调控、揭示物种进化、疾病研究、三维结构差异分析、还原染色体三维结构、构建染色体跨度单体型</p>
</li>
<li><p><strong>1.4 互作本质</strong>统计学上基因组两点之间发生空间接触的概率</p>
</li>
<li><p><strong>1.5 Hi-C实验原理</strong></p>
</li>
<li><p><strong>1.6 二代文库构建及测序</strong></p>
</li>
<li><p><strong>1.7 Hi-C实际文库类型</strong>将HIC数据进行比对是会出现不同的比对情况，需要的是<font color="blue">双端唯一匹配</font>。对单端匹配、多处比对、未比对的reads进行过滤。</p>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/5.png" alt="HiC-Pro的使用"></p>
<p>Hi-C文库构建产生多种分子类型，包括 re-ligation、Dangling ends、self circle 、dump reads 及valid pairs reads等类型。 在 Hi-C 分析中，<font color="red">仅valid pair可以反映基因组上位点与位点间的互作</font>。因此，<font color="blue">非重复的valid pair</font>所占比例是评估Hi-C文库质量重要指标</p>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/6.png" alt="三维基因组技术（三）：Hi-C 数据比对及HiC-Pro的使用"></p>
</li>
<li><p><strong>互作矩阵的生成</strong>由于计算资源，数据量等因素，<font color="blue">需要确定一个互作单位：bin</font>。将基因组按照一定大小分成bin。<font color="red">将过滤后的有效序列分配到这些bin中</font></p>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/7.png" alt="三维基因组技术（三）：Hi-C 数据比对及HiC-Pro的使用"></p>
</li>
<li><p><strong>互作矩阵的矫正</strong>Hi-C数据中由于<font color="blue">内切酶偏好性、基因组本身质量、基因组序列特异性</font> 导致其在基因组不同位置间存在偏差。因此，<font color="red">对互作矩阵校正，使其数据在基因组上每个位点的覆盖度一致</font>。常用矫正方式有<font color="red"><strong>迭代矫正、归一化</strong></font>等</p>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/8.png" alt="三维基因组技术（三）：Hi-C 数据比对及HiC-Pro的使用"></p>
</li>
</ul>
<h2 id="HiC常规软件"><a href="#HiC常规软件" class="headerlink" title="HiC常规软件"></a>HiC常规软件</h2><table>
<thead>
<tr>
<th align="left">软件名</th>
<th align="left">hiclib</th>
<th align="left">HiC-Pro</th>
<th align="left">HICUP</th>
<th align="left">Juice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">比对软件</td>
<td align="left">Bowtie2</td>
<td align="left">Bowtie2</td>
<td align="left">Bowtie2</td>
<td align="left">BWA-mem</td>
</tr>
<tr>
<td align="left">比对策略</td>
<td align="left">迭代比对</td>
<td align="left">全局、局部比对</td>
<td align="left">先截短后比对</td>
<td align="left">Pair-end，嵌合reads过滤</td>
</tr>
<tr>
<td align="left">嵌合reads处理</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">构建矩阵</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">×</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">标准化</td>
<td align="left">ICE</td>
<td align="left">ICE</td>
<td align="left">×</td>
<td align="left">KR</td>
</tr>
<tr>
<td align="left">结果文件</td>
<td align="left">hdf5、hm、bychr(HDF5)</td>
<td align="left">SAM、validpair</td>
<td align="left">SAM</td>
<td align="left">SAM、MND、.hic</td>
</tr>
<tr>
<td align="left">特点</td>
<td align="left">比对结果可靠，存储消耗小</td>
<td align="left">简单易用，输出结果可读</td>
<td align="left">过滤非常严格</td>
<td align="left">后续分析接口多，juicebox可视化</td>
</tr>
</tbody></table>
<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p>HiFi助力同源四倍体紫花苜蓿基因组组装，NC</p>
<blockquote>
<p>Allele-aware chromosome-level genome assembly and efficient transgene-free genome editing for the autotetraploid cultivated alfalfa</p>
</blockquote>
<p>（1）使用Canu默认参数，利用CCS clean reads组装contigs。组装得到的Contig N50值为459kb，总长度为3.15GB。</p>
<blockquote>
<p>We assembled contigs from CCS clean reads using Canu, with default parameters. The N50 values of the contig sets were 459 kb, with total lengths 3154 Mb.</p>
</blockquote>
<p>（2）使用HiC-Pro将Hi-C reads与contigs 进行比对，产生比对BAM文件。</p>
<blockquote>
<p>Hi-C reads were aligned to contigs using <a target="_blank" rel="noopener" href="https://pubmed.ncbi.nlm.nih.gov/26619908/">HiC-Pro(2015)</a>, yielding an alignment BAM file.</p>
</blockquote>
<p>（3）使用注释的蒺藜苜蓿蛋白作为参考，完全基于同源的策略注释contigs。对138,729个同源基因进行了结构注释。用MCscan用于鉴定contigs和参考基因组之间的共线性。显示紫花苜蓿和蒺藜苜蓿之间的高共线性。【下载父母本petunia ref】</p>
<blockquote>
<p>Contigs were annotated with a <font color="red"><strong>solely homology-based strategy</strong></font>, using annotated Medicago truncatula proteins as references. 138,729 homologous genes were structurally annotated. <font color="red"><strong>MCscan</strong> in <strong>Jcvi</strong></font> (<a target="_blank" rel="noopener" href="https://zenodo.org/record/31631#.XpkUyTOeask">https://zenodo.org/record/31631#.XpkUyTOeask</a>) was used to identify <font color="red"><strong>synteny blocks</strong></font> between <strong>contigs and the reference</strong> genome. <font color="red"><strong>Contigs syntenic</strong> to M. truncatula were <strong>stacked and aligned</strong> to M. truncatula chromosomes</font>. The syntenic contigs are summarized in Supplementary Table 4.</p>
</blockquote>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/1.png" alt="STable4"></p>
<p>（4）使用内部脚本处理BAM文件，去除等位基因contigs之间的links。使用ALLHiC软件，<font color="red">提取、聚类和重排Contigs</font> (Contigs syntenic与蒺藜苜蓿染色体一致)，得到原始的scaffolds。</p>
<blockquote>
<p>An <strong>in-house script</strong> was used to <font color="red">prune the BAM</font> file and <font color="red">discard links between allelic contigs</font>. Contigs syntenic to one chromosome of M. truncatula, e.g., chr1, were extracted, sub-clustered and reordered using <font color="red">ALLHiC</font>, yielding a raw scaffold set.</p>
</blockquote>
<p>（5）<a target="_blank" rel="noopener" href="https://pubmed.ncbi.nlm.nih.gov/27467250/">Juicebox</a>用于以图形和交互方式微调组装的scaffolds。剪裁了40个总长度达1800Mb的scaffolds 。</p>
<blockquote>
<p>Juicebox45 was used for fine-tuning assembled scaffolds in a graphic and inter-active fashion. Forty scaffolds with a total length of 1800 Mb were cropped (Supplementary Table 5).</p>
</blockquote>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/2.png" alt="STable5"></p>
<p>（6） 基于组装的scaffold，通过Hi-C数据，每个unplaced contig被分配到互作最强的那些contig cluster里。</p>
<blockquote>
<p>Based on this scaffold assembly, each unplaced contig was assigned to the contig cluster, to which the contig was most connected by Hi-C data.</p>
</blockquote>
<p>（7）使用ALLHiC对那些contig clusters再次进行重排和构建scaffold。</p>
<blockquote>
<p>Those contig clusters were reordered and scaffolded using ALLHiC. </p>
</blockquote>
<p>（8）使用Juicebox对scaffolds进行微调，并从scaffolds上去除不一致的contigs，产生最终的染色体基因组，其包含32条染色体(8个同源组，每个组中有4个等位基因染色体)，总长度为2738Mb，和419Mb未挂载到染色体水平的序列。</p>
<blockquote>
<p>Using Juicebox, scaffolds were fine-tuned and discordant contigs were removed from scaffolds, and the final chromosome assembly was generated, containing 32 chromosomes with a total length of 2738 Mb (Supplementary Table 6).</p>
</blockquote>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/3.png" alt="STable6"></p>
<h1 id="HiC-Pro-install"><a href="#HiC-Pro-install" class="headerlink" title="HiC-Pro install"></a>HiC-Pro install</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">conda env create -f ./HiC-Pro/environment.yml -p ///software/HiC_Pro_ENV</span><br><span class="line"><span class="comment">#【install env in my software dir】</span></span><br><span class="line">conda activate env</span><br><span class="line"></span><br><span class="line">tar -zxvf HiC-Pro-master.tar.gz</span><br><span class="line"><span class="built_in">cd</span> HiC-Pro-master</span><br><span class="line"><span class="comment">## Edit config-install.txt file if necessary</span></span><br><span class="line">make configure</span><br><span class="line">make install<span class="comment"># failed </span></span><br><span class="line"><span class="comment">#(g++ -Wall -O2 -std=c++0x -o build_matrix /xtdisk/xueyb_group/wangchenA/software/HiC-Pro-3.1.0/scripts/src/build_matrix.cpp; mv build_matrix /xtdisk/xueyb_group/wangchenA/software/HiC-Pro-3.1.0/scripts)</span></span><br><span class="line"><span class="comment">#(g++ -Wall -O2 -std=c++0x -o cutsite_trimming /xtdisk/xueyb_group/wangchenA/software/HiC-Pro-3.1.0/scripts/src/cutsite_trimming.cpp; mv cutsite_trimming /xtdisk/xueyb_group/wangchenA/software/HiC-Pro-3.1.0/scripts)</span></span><br><span class="line"><span class="comment">#cp -Ri /xtdisk/xueyb_group/wangchenA/software/HiC-Pro-3.1.0 /usr/local/bin//HiC-Pro_3.1.0</span></span><br><span class="line"><span class="comment">#cp: cannot create directory ‘/usr/local/bin//HiC-Pro_3.1.0’: Permission denied</span></span><br><span class="line"><span class="comment">#make: *** [Makefile:78: cp] Error 1</span></span><br><span class="line"></span><br><span class="line">but <span class="keyword">in</span> the bin file,it can be use?</span><br></pre></td></tr></table></figure>

<p>Make configure and make install, whats the function of those two steps?</p>
<h1 id="HiC-Pro-GitHub"><a href="#HiC-Pro-GitHub" class="headerlink" title="HiC-Pro-GitHub"></a><a target="_blank" rel="noopener" href="https://github.com/nservant/HiC-Pro">HiC-Pro-GitHub</a></h1><p><a target="_blank" rel="noopener" href="https://doi.org/10.1186/s13059-015-0831-x">Genome Biology 2015</a></p>
<p>HiC-Pro was designed to process Hi-C data, from <font color="red"><strong>raw fastq files</strong></font> (paired-end Illumina data) to <font color="red"><strong>normalized contact maps</strong></font>. It supports the main Hi-C protocols, including digestion protocols as well as protocols that do not require restriction enzymes such as DNase Hi-C. In practice, HiC-Pro was successfully <font color="blue"><strong>applied to many data-sets</strong></font> including dilution Hi-C, in situ Hi-C, DNase Hi-C, Micro-C, capture-C, capture Hi-C or HiChip data.<br>The pipeline is flexible, scalable and optimized. It can operate either on a single laptop or on a computational cluster. HiC-Pro is sequential and each step of the workflow can be run independantly.<br>HiC-Pro includes a fast implementatation of the iterative correction method (see the <a target="_blank" rel="noopener" href="https://github.com/hiclib/iced">iced python package</a> for more information). Finally, HiC-Pro can use phasing data to build <a target="_blank" rel="noopener" href="https://github.com/nservant/HiC-Pro/blob/master/doc/AS.md">allele-specific contact maps</a>.</p>
<h2 id="HiC-Pro-annotation-files"><a href="#HiC-Pro-annotation-files" class="headerlink" title="HiC-Pro annotation files"></a>HiC-Pro annotation files</h2><p>In order to process the raw data, HiC-Pro requires three annotation files. Note that the pipeline is provided with some Human and Mouse annotation files.<br><strong>Please be sure that the chromosome names are the same than the ones used in your bowtie indexes !</strong></p>
<ul>
<li><strong>A BED file</strong> of the <font color="blue"><strong>restriction fragments after digestion</strong></font>. This file <font color="blue">depends</font> both of the <font color="blue"><strong>restriction enzyme</strong></font> and the <font color="blue"><strong>reference genome</strong></font>. See the <a target="_blank" rel="noopener" href="https://github.com/nservant/HiC-Pro/blob/master/doc/FAQ.md">FAQ</a> and the <a target="_blank" rel="noopener" href="https://github.com/nservant/HiC-Pro/blob/master/doc/UTILS.md">HiC-Pro utilities</a> for details about <font color="blue"><strong>how to generate</strong></font> this file. A few annotation files are provided with the HiC-Pro sources as examples. 根据限制性内切酶消化的参考基因组信息 .bed文件。酶切图谱</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example：/PATH/TO/HiC-Pro_2.11.1/annotation</span></span><br><span class="line"> head HindIII_resfrag_hg19.bed</span><br><span class="line"> chr1   0       16007   HIC_chr1_1    0   +</span><br><span class="line"> chr1   16007   24571   HIC_chr1_2    0   +</span><br><span class="line"> chr1   24571   27981   HIC_chr1_3    0   +</span><br><span class="line"> (...)</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#GENOME_FRAGMENT = # 储存消化碎片位置信息的bed文件，一般在HiC-Pro的annotation文件夹下</span></span><br><span class="line"><span class="comment">#LIGATION_SITE = # 酶切位点重连接后的序列</span></span><br><span class="line"><span class="comment">#注：GENOME_FRAGMENT 和 LIGATION_SITE 完全取决于使用了什么酶，一般HiC建库的酶是Hind III，所以要仔细检查数据来源的说明。 </span></span><br><span class="line">digest_genome.py -r A^AGCTT -o HindIII_resfrag_hg19.bed hg19_rCRSchrm.fa  </span><br></pre></td></tr></table></figure>

<p>通过软件脚本产生基因组酶切图谱，输入内切酶名称或者酶切位点序列都可以，用法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">digest_genome.py -r A^AGCTT -o mm9_hindiii.bed mm9.fasta</span><br><span class="line">digest_genome.py -r hindiii -o mm9_hindiii.bed mm9.fasta</span><br></pre></td></tr></table></figure>

<p>NcoI、BamHI、EcoRI、HindIII、NdeI、XhoI, 参考：<a target="_blank" rel="noopener" href="https://www.biomart.cn/experiment/430/457/741/43956.htm"><font color="red"><strong>常见限制性内切酶识别序列(酶切位点)</strong></font></a></p>
<table>
<thead>
<tr>
<th align="left">限制性内切酶</th>
<th align="left">酶切位点，<code>^</code>为切割位点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MboI</td>
<td align="left">^GATC</td>
</tr>
<tr>
<td align="left">DpnII</td>
<td align="left">^GATC</td>
</tr>
<tr>
<td align="left">BglII</td>
<td align="left">A^GATCT</td>
</tr>
<tr>
<td align="left">HindIII</td>
<td align="left">A^AGCTT</td>
</tr>
</tbody></table>
<ul>
<li><strong>A table file</strong> of chromosomes’ size. This file can be easily find on the <font color="blue">UCSC genome browser</font>. Of note, pay attention to the contigs or scaffolds, and be aware that HiC-pro will generate a map per chromosomes pair. For model organisms such as Human or Mouse, which are well annotated, we usually recommand to remove all scaffolds. 染色体大小的表格文件。从UCSC下载染色体长度文件，或自己根据fasta序列统计长度</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#example：/PATH/TO/HiC-Pro_2.11.1/annotation</span><br><span class="line">head chrom_hg19.sizes</span><br><span class="line">   chr1    249250621</span><br><span class="line">   chr2    243199373</span><br><span class="line">   chr3    198022430</span><br><span class="line">   chr4    191154276</span><br><span class="line">   chr5    180915260</span><br><span class="line">   chr6    171115067</span><br><span class="line">   chr7    159138663</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>

<p><font color="green"><strong>how?</strong></font> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">samtools faidx genome.fa</span><br><span class="line">awk ‘&#123;print $1 &quot;t&quot; $2&#125;‘ genome.fa.fai &gt; genome_sizes.bed</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>The bowtie2 indexes</strong>. See the <a target="_blank" rel="noopener" href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml">bowtie2 manual page</a> for details about how to create such indexes.</p>
</li>
<li><p>```sh<br>bowtie2-build hg19.fasta hg19</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## how to use</span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">  HiC-Pro --help</span><br><span class="line">  usage : HiC-Pro -i INPUT -o OUTPUT -c CONFIG [-s ANALYSIS_STEP] [-p] [-h] [-v]</span><br><span class="line">  Use option -h|--help for more information</span><br><span class="line"></span><br><span class="line">  HiC-Pro 3.1.0</span><br><span class="line">  ---------------</span><br><span class="line">  OPTIONS</span><br><span class="line"></span><br><span class="line">   -i|--input INPUT : &#x27;input data folder&#x27;; contains a folder per sample with input files</span><br><span class="line">   -o|--output OUTPUT : &#x27;output folder&#x27;</span><br><span class="line">   -c|--conf CONFIG : &#x27;configuration file&#x27; for Hi-C processing</span><br><span class="line">   [-p|--parallel] : if specified run HiC-Pro on a cluster&#x27;?&#x27;</span><br><span class="line">   [-s|--step ANALYSIS_STEP] : run only a subset of the HiC-Pro workflow; &#x27;if not specified the complete workflow is run&#x27;</span><br><span class="line">      mapping: perform reads &#x27;alignment&#x27; - require fast files</span><br><span class="line">      proc_hic: perform Hi-C &#x27;filtering&#x27; - require BAM files</span><br><span class="line">      quality_checks: run Hi-C &#x27;quality control&#x27; plots</span><br><span class="line">      merge_persample: &#x27;merge&#x27; multiple inputs and remove duplicates if specified - require .validPairs files</span><br><span class="line">      build_contact_maps: &#x27;Build raw inter/intrachromosomal contact maps&#x27; - require .allValidPairs files</span><br><span class="line">      ice_norm : run ICE &#x27;normalization&#x27; on contact maps - require .matrix files</span><br><span class="line">   [-h|--help]: help</span><br><span class="line">   [-v|--version]: version</span><br></pre></td></tr></table></figure></li>
<li><p><font color="blue"><strong>Copy and edit</strong></font> the configuration file <font color="blue"><strong>‘config-hicpro.txt’</strong> </font> in your <font color="blue"><strong>local folder</strong></font>. See the <a target="_blank" rel="noopener" href="https://github.com/nservant/HiC-Pro/blob/master/doc/MANUAL.md">manual</a> for details about the configuration file</p>
</li>
<li><p>Put <font color="blue"><strong>all input files in a rawdata folder</strong></font>. The input files have to be organized with <font color="blue"><strong>one folder per sample</strong></font>, such as;</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ PATH_TO_MY_DATA</span><br><span class="line">  + sample1</span><br><span class="line">    ++ file1_R1.fastq.gz</span><br><span class="line">    ++ file1_R2.fastq.gz</span><br><span class="line">    ++ ...</span><br><span class="line">  + sample2</span><br><span class="line">    ++ file1_R1.fastq.gz</span><br><span class="line">    ++ file1_R2.fastq.gz</span><br><span class="line">  *...</span><br></pre></td></tr></table></figure>

<ul>
<li>Run HiC-Pro on your <font color="blue"><strong>laptop</strong></font> in standalone model</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MY_INSTALL_PATH/bin/HiC-Pro -i <span class="string">&#x27;FULL&#x27;</span>_PATH_TO_DATA_FOLDER -o FULL_PATH_TO_OUTPUTS -c MY_LOCAL_CONFIG_FILE</span><br></pre></td></tr></table></figure>

<ul>
<li>Run HiC-Pro on a <font color="blue"><strong>cluster</strong></font> (TORQUE/SGE/SLURM/LSF)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MY_INSTALL_PATH/bin/HiC-Pro -i FULL_PATH_TO_DATA_FOLDER -o FULL_PATH_TO_OUTPUTS -c MY_LOCAL_CONFIG_FILE -p</span><br></pre></td></tr></table></figure>

<ul>
<li>In the latter <font color="blue">case[cluster]</font>, you will have the following message :</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Please run HiC-Pro in two steps :</span><br><span class="line"> 1- The following command will launch the parallel workflow through 12 torque jobs:</span><br><span class="line"> qsub HiCPro_step1.sh</span><br><span class="line"> 2- The second command will merge all outputs to generate the contact maps:</span><br><span class="line"> qsub HiCPro_step2.sh</span><br></pre></td></tr></table></figure>

<p>Execute the displayed command from the <font color="blue"><strong>output folder</strong></font>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qsub HiCPro_step1.sh</span><br></pre></td></tr></table></figure>

<p>Once executed succesfully (may take several hours), run the step using:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qsub HiCPro_step2.sh</span><br></pre></td></tr></table></figure>

<h2 id="config-editing"><a href="#config-editing" class="headerlink" title="config editing"></a>config editing</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## SYSTEM AND SCHEDULER - Start Editing Here !!</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">N_CPU = 2</span><br><span class="line">LOGFILE = hicpro.log</span><br><span class="line">JOB_NAME =</span><br><span class="line">JOB_MEM =</span><br><span class="line">JOB_WALLTIME =</span><br><span class="line">JOB_QUEUE =</span><br><span class="line">JOB_MAIL =</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOWTIE2_IDX_PATH =</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">## Digestion Hi-C</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">GENOME_FRAGMENT = HindIII_resfrag_hg19.bed</span><br><span class="line">LIGATION_SITE = AAGCTAGCTT</span><br><span class="line">MIN_FRAG_SIZE =</span><br><span class="line">MAX_FRAG_SIZE =</span><br><span class="line">MIN_INSERT_SIZE =</span><br><span class="line">MAX_INSERT_SIZE =</span><br><span class="line">MIN_MAPQ: 最低的质量分数，用于筛选，表示低于该MAPQ值会被过滤</span><br><span class="line">BOWTIE2_IDX_PATH: 基因组bowtie2索引路径，eg:/path/hg19</span><br><span class="line">BOWTIE2_GLOBAL_OPTIONS: 默认GLOBAL比对设置</span><br><span class="line">BOWTIE2_LOCAL_OPTIONS: 默认LOCAL比对设置</span><br><span class="line">REFERENCE_GENOME： Bowtie2索引前缀</span><br><span class="line">GENOME_SIZE： 基因组sizes bed文件</span><br><span class="line">GENOME_FRAGMENT: 基因组酶切文件,eg. /path/hg19_HindIII.bed</span><br><span class="line">LIGATION_SITE: 酶切位点末端补平再次连接后形成的嵌合序列，eg. AAGCTAGCTT</span><br><span class="line">MIN_FRAG_SIZE: 最小的理论酶切片段大小,eg. 100</span><br><span class="line">MAX_FRAG_SIZE: 最大的理论酶切片段大小,eg. 100000</span><br><span class="line">MIN_INSERT_SIZE: 最小的文库片段大小,eg.100</span><br><span class="line">MAX_INSERT_SIZE: 最大的文库片段大小,eg.1000</span><br><span class="line"><span class="string">&#x27;BIN_SIZE:需要生成的矩阵分辨率（bp)&#x27;</span></span><br><span class="line">MATRIX_FORMAT：矩阵的形式，upper表示保留上半部分</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BOWTIE2_IDX_PATH = <span class="comment"># bowtie2索引文件目录，索引文件提前下载或用bowtie2-build生成</span></span><br><span class="line">REFERENCE_GENOME = <span class="comment"># bowtie2索引的文件名</span></span><br><span class="line">GENOME_SIZE = <span class="comment"># 染色体大小文件，可从http://hgdownload.cse.ucsc.edu/goldenPath/ 下载</span></span><br><span class="line">GENOME_FRAGMENT = <span class="comment"># 储存消化碎片位置信息的bed文件，一般在HiC-Pro的annotation文件夹下</span></span><br><span class="line">LIGATION_SITE = AAGCTAGCTT<span class="comment"># 酶切位点重连接后的序列</span></span><br><span class="line"><span class="comment"># 注：GENOME_FRAGMENT 和 LIGATION_SITE 完全取决于使用了什么酶，一般来说是Hind III，所以要仔细检查数据来源的说明。 </span></span><br><span class="line">PAIR2_EXT = <span class="comment"># 根据文件名称，分别输入双端数据文件名称，不用输入后缀</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#???GENOME_SIZE = 在建立的索引目录下新建一个txt文件：</span></span><br><span class="line">cat &gt;chrom_bacteria.sizes  <span class="comment">#创建一个新的文件cat &gt; filename，文件名我是参考hicpro的配置示例 </span></span><br><span class="line">Chromosome 4016942  <span class="comment">#在文件中写入内容，表明这个参考基因的大小是4016942bp,1bp即为1个碱基对（base pair）</span></span><br></pre></td></tr></table></figure>

<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>The test dataset and associated results are available <a target="_blank" rel="noopener" href="https://zerkalo.curie.fr/partage/HiC-Pro/">here</a>. Small fastq files (2M reads) extracted from the Dixon et al. 2012 paper are available for test.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Get the data. Will download a test_data folder and a configuration file</span></span><br><span class="line"> wget https://zerkalo.curie.fr/partage/HiC-Pro/HiCPro_testdata.tar.gz &amp;&amp; tar -zxvf HiCPro_testdata.tar.gz</span><br><span class="line"></span><br><span class="line"> <span class="comment">## Edit the configuration file and set the path to Human bowtie2 indexes</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">## Run HiC-Pro</span></span><br><span class="line"> time HICPRO_INSTALL_DIR/bin/HiC-Pro -c config_test_latest.txt -i test_data -o hicpro_latest_test</span><br></pre></td></tr></table></figure>

<h1 id="HIC-PRO’S-DOC"><a href="#HIC-PRO’S-DOC" class="headerlink" title="HIC-PRO’S DOC"></a><a target="_blank" rel="noopener" href="http://nservant.github.io/HiC-Pro/">HIC-PRO’S DOC</a></h1><h1 id="分步原理"><a href="#分步原理" class="headerlink" title="分步原理"></a>分步原理</h1><p>ref：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/76533e6d6152">https://www.jianshu.com/p/76533e6d6152</a></p>
<p><img src="/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/4.png" alt="img"></p>
<ul>
<li><p><font color="red"><strong>比对、过滤HiC比对结果、检测有效HiC序列、结果合并、构建HiC关联图谱、关联图谱标准化。</strong></font></p>
</li>
<li><p>HiC-Pro可输出各个尺度的HiC<font color="red">标准化互作图谱</font>，从每个<font color="red">窗口5Kb到1Mb</font>，窗口越大，生成互作关系越少，计算时间就越少，反之越多。同时HiC-Pro能与下游可视化软件<font color="red"><strong>HiCPlotter</strong></font>等兼容，输出文件可直接用于可视化分析。</p>
</li>
<li><p>HiC-Pro<font color="red">自动化比对，标准化和构建相互作用矩阵</font>，在处理多样化的测序数据时，HiC-Pro能够<strong>检测和自动过滤</strong>测序数量差的reads和无效片段。</p>
</li>
</ul>
<h2 id="1-Reads-Mapping"><a href="#1-Reads-Mapping" class="headerlink" title="1.Reads Mapping"></a>1.Reads Mapping</h2><p>将fastq文件用bowtie2 mapping一次，查看log：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat mapping_step1.log</span><br><span class="line"><span class="comment">###mapping fastq to reference genome , 将unmapping的read 另存为 unmap.fastq</span></span><br><span class="line">/PATH/TO/bowtie2/bowtie2-2.3.3.1/bowtie2 --very-sensitive -L 30 --score-min L,-0.6,-0.2 --end-to-end --reorder --un bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap.fastq --rg-id BMG --rg SM:SRR400264_00_R2 -p 20 -x /PATH/TO/HiC-Pro_2.11.1/Bowtie2Index/hg19 -U rawdata/dixon_2M/SRR400264_00_R2.fastq.gz 2&gt;&gt; logs/dixon_2M/SRR400264_00_R2_bowtie2.log| /PATH/TO/samtools/samtools-1.6/bin/samtools view -F 4 -bS - &gt; bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.bam</span><br><span class="line"></span><br><span class="line">/PATH/TO/bowtie2/bowtie2-2.3.3.1/bowtie2 --very-sensitive -L 30 --score-min L,-0.6,-0.2 --end-to-end --reorder --un bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap.fastq --rg-id BMG --rg SM:SRR400264_00_R1 -p 20 -x /PATH/TO/HiC-Pro_2.11.1/Bowtie2Index/hg19 -U rawdata/dixon_2M/SRR400264_00_R1.fastq.gz 2&gt;&gt; logs/dixon_2M/SRR400264_00_R1_bowtie2.log| /PATH/TO/samtools/samtools-1.6/bin/samtools view -F 4 -bS - &gt; bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.bam</span><br></pre></td></tr></table></figure>

<p>结果文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|   |-- bwt2_global</span><br><span class="line">|   |   |-- dixon_2M</span><br><span class="line">|   |   |   |-- SRR400264_00_R1_hg19.bwt2glob.bam</span><br><span class="line">|   |   |   |-- SRR400264_00_R1_hg19.bwt2glob.unmap.fastq</span><br><span class="line">|   |   |   |-- SRR400264_00_R2_hg19.bwt2glob.bam</span><br><span class="line">|   |   |   |-- SRR400264_00_R2_hg19.bwt2glob.unmap.fastq</span><br><span class="line">|   |   `-- dixon_2M_2</span><br><span class="line">|   |       |-- SRR400264_01_R1_hg19.bwt2glob.bam</span><br><span class="line">|   |       |-- SRR400264_01_R1_hg19.bwt2glob.unmap.fastq</span><br><span class="line">|   |       |-- SRR400264_01_R2_hg19.bwt2glob.bam</span><br><span class="line">|   |       |-- SRR400264_01_R2_hg19.bwt2glob.unmap.fastq</span><br></pre></td></tr></table></figure>

<p>有mapping和unmapping。因为read是嵌合基因。mapping上的是背景基因组。<font color="blue">unmapping需要下一步处理</font>。</p>
<h2 id="2-片段分配和过滤"><a href="#2-片段分配和过滤" class="headerlink" title="2. 片段分配和过滤"></a>2. 片段分配和过滤</h2><p>查看log</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat mapping_step2.log</span><br><span class="line"><span class="comment">### 酶切</span></span><br><span class="line">/PATH/TO/HiC-Pro/HiC-Pro_2.11.1/scripts/cutsite_trimming --fastq bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap.fastq --cutsite AAGCTAGCTT --out bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap_trimmed.fastq &gt; logs/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap_readsTrimming.log 2&gt;&amp;1</span><br><span class="line">/PATH/TO/HiC-Pro/HiC-Pro_2.11.1/scripts/cutsite_trimming --fastq bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap.fastq --cutsite AAGCTAGCTT --out bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap_trimmed.fastq &gt; logs/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap_readsTrimming.log 2&gt;&amp;1</span><br><span class="line"><span class="comment">### 再用bowtie2 mapping一次</span></span><br><span class="line">/PATH/TO/bowtie2/bowtie2-2.3.3.1/bowtie2 --very-sensitive -L 20 --score-min L,-0.6,-0.2 --end-to-end --reorder --rg-id BML --rg SM:SRR400264_00_R1_hg19.bwt2glob.unmap -p 20 -x /PATH/TO/HiC-Pro/HiC-Pro_2.11.1/Bowtie2Index/hg19 -U bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap_trimmed.fastq 2&gt;&gt; logs/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap_bowtie2.log | /PATH/TO/samtools/samtools-1.6/bin/samtools view -bS - &gt; bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line">/PATH/TO/bowtie2/bowtie2-2.3.3.1/bowtie2 --very-sensitive -L 20 --score-min L,-0.6,-0.2 --end-to-end --reorder --rg-id BML --rg SM:SRR400264_00_R2_hg19.bwt2glob.unmap -p 20 -x /PATH/TO/HiC-Pro/HiC-Pro_2.11.1/Bowtie2Index/hg19 -U bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap_trimmed.fastq 2&gt;&gt; logs/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap_bowtie2.log | /PATH/TO/samtools/samtools-1.6/bin/samtools view -bS - &gt; bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap_bwt2loc.bam</span><br></pre></td></tr></table></figure>

<p>这一步将unmapping结果，用酶切位点分割，然后将分割结果，再mapping一次。得到结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|   |-- bwt2_local</span><br><span class="line">|       |-- dixon_2M</span><br><span class="line">|       |   |-- SRR400264_00_R1_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line">|       |   |-- SRR400264_00_R1_hg19.bwt2glob.unmap_trimmed.fastq</span><br><span class="line">|       |   |-- SRR400264_00_R2_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line">|       |   |-- SRR400264_00_R2_hg19.bwt2glob.unmap_trimmed.fastq</span><br><span class="line">|       |-- dixon_2M_2</span><br><span class="line">|           |-- SRR400264_01_R1_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line">|           |-- SRR400264_01_R1_hg19.bwt2glob.unmap_trimmed.fastq</span><br><span class="line">|           |-- SRR400264_01_R2_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line">|           |-- SRR400264_01_R2_hg19.bwt2glob.unmap_trimmed.fastq</span><br></pre></td></tr></table></figure>

<h2 id="3-mapping-combine-log"><a href="#3-mapping-combine-log" class="headerlink" title="3. mapping_combine.log"></a>3. mapping_combine.log</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat mapping_combine.log</span><br><span class="line"></span><br><span class="line"><span class="comment">### 将global的bam与local的bam用samtools merge</span></span><br><span class="line">/PATH/TO/samtools/samtools-1.6/bin/samtools merge -@ 20 -n -f bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.bam bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.bam bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R1_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line">/PATH/TO/samtools/samtools-1.6/bin/samtools merge -@ 20 -n -f bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.bam bowtie_results/bwt2_global/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.bam bowtie_results/bwt2_local/dixon_2M/SRR400264_00_R2_hg19.bwt2glob.unmap_bwt2loc.bam</span><br><span class="line"></span><br><span class="line"><span class="comment">### sort</span></span><br><span class="line">/PATH/TO/samtools/samtools-1.6/bin/samtools sort -@ 20 -n -T tmp/SRR400264_00_R2_hg19 -o bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.sorted.bam bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.bam</span><br><span class="line">/PATH/TO/samtools/samtools-1.6/bin/samtools sort -@ 20 -n -T tmp/SRR400264_00_R1_hg19 -o bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.sorted.bam bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.bam</span><br><span class="line"></span><br><span class="line">[bam_sort_core] merging from 0 files and 20 in-memory blocks...</span><br><span class="line">[bam_sort_core] merging from 0 files and 20 in-memory blocks...</span><br><span class="line"></span><br><span class="line"><span class="comment">### 改名</span></span><br><span class="line">mv bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.sorted.bam bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.bam</span><br><span class="line">mv bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.sorted.bam bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.bam</span><br></pre></td></tr></table></figure>

<h2 id="4、merge"><a href="#4、merge" class="headerlink" title="4、merge"></a>4、merge</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 将R1与R2 merge为一个文件。</span></span><br><span class="line">cat mergeSAM.log</span><br><span class="line">/PATH/TO/python/python-2.7.10/bin/python /PATH/TO/HiC-Pro/HiC-Pro_2.11.1/scripts/mergeSAM.py -q 0 -t -v -f bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.bam -r bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.bam -o bowtie_results/bwt2/dixon_2M/SRR400264_00_hg19.bwt2pairs.bam</span><br><span class="line"><span class="comment">## mergeBAM.py</span></span><br><span class="line"><span class="comment">## forward= bowtie_results/bwt2/dixon_2M/SRR400264_00_R1_hg19.bwt2merged.bam</span></span><br><span class="line"><span class="comment">## reverse= bowtie_results/bwt2/dixon_2M/SRR400264_00_R2_hg19.bwt2merged.bam</span></span><br><span class="line"><span class="comment">## output= bowtie_results/bwt2/dixon_2M/SRR400264_00_hg19.bwt2pairs.bam</span></span><br><span class="line"><span class="comment">## min mapq= 0</span></span><br><span class="line"><span class="comment">## report_single= False</span></span><br><span class="line"><span class="comment">## report_multi= False</span></span><br><span class="line"><span class="comment">## verbose= True</span></span><br><span class="line"><span class="comment">## Merging forward and reverse tags ...</span></span><br></pre></td></tr></table></figure>

<h2 id="5、利用HiCPro的mapped-2hic-fragments-py程序将比对结果转化为Hi-C片段信息"><a href="#5、利用HiCPro的mapped-2hic-fragments-py程序将比对结果转化为Hi-C片段信息" class="headerlink" title="5、利用HiCPro的mapped_2hic_fragments.py程序将比对结果转化为Hi-C片段信息"></a>5、利用HiCPro的mapped_2hic_fragments.py程序将比对结果转化为Hi-C片段信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat mapped_2hic_fragments.log</span><br><span class="line">/PATH/TO/python /PATH/TO/HiC-Pro/HiC-Pro_2.11.1/scripts/mapped_2hic_fragments.py -v -S -t 100 -m 100000 -s 100 -l 600 -a -f /PATH/TO/HiC-Pro_2.11.1/annotation/HindIII_resfrag_hg19.bed -r bowtie_results/bwt2/dixon_2M/SRR400264_00_hg19.bwt2pairs.bam -o hic_results/data/dixon_2M</span><br><span class="line"><span class="comment">## overlapMapped2HiCFragments.py</span></span><br><span class="line"><span class="comment">## mappedReadsFile= bowtie_results/bwt2/dixon_2M/SRR400264_00_hg19.bwt2pairs.bam</span></span><br><span class="line"><span class="comment">## fragmentFile= /PATH/TO/HiC-Pro/HiC-Pro_2.11.1/annotation/HindIII_resfrag_hg19.bed</span></span><br><span class="line"><span class="comment">## minInsertSize= 100</span></span><br><span class="line"><span class="comment">## maxInsertSize= 600</span></span><br><span class="line"><span class="comment">## minFragSize= 100</span></span><br><span class="line"><span class="comment">## maxFragSize= 100000</span></span><br><span class="line"><span class="comment">## allOuput= True</span></span><br><span class="line"><span class="comment">## SAM ouput= True</span></span><br><span class="line"><span class="comment">## verbose= True</span></span><br></pre></td></tr></table></figure>

<p>再对输出的valid pairs文件排序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANG=en; sort -T tmp -k2,2V -k3,3n -k5,5V -k6,6n -o hic_results/data/sample/sample_sample_genome_ref.bwt2pairs.validPairs hic_results/data/sample/sample_sample_genome_ref.bwt2pairs.validPairs</span><br></pre></td></tr></table></figure>

<h2 id="6-对所有的valid-pairs进行合并"><a href="#6-对所有的valid-pairs进行合并" class="headerlink" title="6 对所有的valid pairs进行合并"></a>6 对所有的valid pairs进行合并</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANG=en; sort -T tmp -S <span class="number">50</span>% -k2,<span class="number">2</span>V -k3,<span class="number">3</span>n -k5,<span class="number">5</span>V -k6,<span class="number">6</span>n -m hic_results/data/dixon_2M_2/SRR400264_01_hg19.bwt2pairs.validPairs | awk -F<span class="string">&quot;\t&quot;</span> <span class="string">&#x27;BEGIN&#123;c1=0;c2=0;s1=0;s2=0&#125;(c1!=<span class="subst">$2</span> || c2!=<span class="subst">$5</span> || s1!=<span class="subst">$3</span> || s2!=<span class="subst">$6</span>)&#123;print;c1=<span class="subst">$2</span>;c2=<span class="subst">$5</span>;s1=<span class="subst">$3</span>;s2=<span class="subst">$6</span>&#125;&#x27;</span> &gt; hic_results/data/dixon_2M_2/dixon_2M_2.allValidPairs</span><br></pre></td></tr></table></figure>

<p>生成最终文件dixon_2M_2.allValidPairs。</p>
<p>这个文件还不能可视化，如果要可视化，一般在jucebox里面查看。需要用配套的hicpro2juicebox.sh来转化：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## e.g.1</span></span><br><span class="line">HICPRO_PATH/bin/utils/hicpro2juicebox.sh -i hicpro_res/hic_results/data/dixon_2M/dixon_2M_allValidPairs -g hg19 -j /usr/<span class="built_in">local</span>/juicebox/juicebox_clt_1.4.jar</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-j jar</span><br><span class="line">/PATH/TO/juicer/juicer/UGER/scripts/juicer_tools.jar</span><br></pre></td></tr></table></figure>

<h1 id="HiC-Pro-输出"><a href="#HiC-Pro-输出" class="headerlink" title="HiC-Pro 输出"></a>HiC-Pro 输出</h1><p>共有<strong>bowtie_results</strong>和<strong>hic_results</strong>两个结果文件夹。</p>
<p>其中<strong>bowtie_results</strong>下三个文件夹：bwt2、bwt2_global和bwt2_local，分别是序列比对结果、<font color="blue">染色体间</font>关联比对结果和<font color="blue">染色体内</font>部关联比对结果。bwt2文件夹有数据统计结果输出文件，如mpairstat文件。</p>
<p><strong>hic_results</strong>文件夹下共有data、matrix以及pic三个文件夹。</p>
<ul>
<li><p>data文件夹下是比对上的有效序列对，文件末尾为_allValidPairs合并后的pairs数据</p>
<p><code>DEPairs</code>:Dangling end pairs数据</p>
<p><code>DumpPairs</code>:实际片段长度和理论片段长度不同的数据</p>
<p><code>REPairs</code>：酶切片段重新连接的pairs</p>
<p><code>FiltePairs</code>:MAPQ过低的pairs</p>
<p><code>SCPairs</code>：片段自连的pairs</p>
</li>
<li><p>pic文件夹下是各类结果数据统计；存放统计分析图片</p>
<p>HiC文库片段分布文件</p>
<p>双端比对过滤质控图</p>
<p>有效数据过滤质控图</p>
<p>配对数据不同类型数据比例展示图</p>
</li>
<li><p>matrix文件夹下分为 iced(标准化) 和 raw(原始) 两个文件夹，分别标准化后的关联矩阵和初始的关联矩阵。存放不同分辨率矩阵文件</p>
</li>
</ul>
<p>后续compartment，TAD和loop？</p>
<h1 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h1><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzUyMTk4ODM0OQ==&mid=2247483678&idx=1&sn=a1aa97892723f6fb51bd3b01a6441e6c&chksm=f9d3f08ccea4799af0a4401e938307a3f6e860239e905deb6963a82a8fc799a4af504e96bc10&scene=178&cur_album_id=1399424041152528385#rd">微信公众号</a></p>
<p><a target="_blank" rel="noopener" href="https://weixin.sogou.com/weixin?type=2&query=%E6%9F%93%E8%89%B2%E8%B4%A8%E9%AB%98%E7%BA%A7%E7%BB%93%E6%9E%84%E7%A0%94%E7%A9%B6%E4%B9%8BHi-C%E6%8A%80%E6%9C%AF%EF%BC%88%E4%B8%8B%E7%AF%87%EF%BC%89%E2%80%94%E2%80%94%E5%8F%AF%E8%A7%86%E5%8C%96%E5%AE%9E%E6%88%98&ie=utf8&s_from=input&_sug_=n&_sug_type_=&w=01019900&sut=935&sst0=1646835948011&lkt=2,1646835946980,1646835947908">染色质高级结构研究之Hi-C技术（下篇）——可视化实战</a></p>
<h1 id="Error-debug"><a href="#Error-debug" class="headerlink" title="Error debug"></a>Error debug</h1><blockquote>
<p>HIC-PRO DOES NOT GENERATE ANY MAPS<br>HiC-Pro is using the chrom.sizes files to build the map.<br>Be sure that your chromosome names are the same in all annotations files (bowtie2 indexes, restriction fragments, chromosome sizes, etc.)</p>
</blockquote>
<blockquote>
<p>hiclib and mirnylib are not compatible with python 2.5 and 3.x, but work fine with py 2.6, 2.7</p>
<p>hiclib主要用于数据标准化，hicpro可以，为什么还要安装hiclib? 或者是想比较两者分析的结果？</p>
<p>HiC-Pro需要python版本&gt;=3.7, 安装3.9</p>
</blockquote>
<hr>
<p>ref</p>
<p><a target="_blank" rel="noopener" href="https://www.plob.org/article/24873.html">https://www.plob.org/article/24873.html</a></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Wang C
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/" title="HiFi-5-[HiC-Pro]-[MCscan]-[ALLHiC]">https://wangc1106.github.io/blog/2022/03/09/2022-03-09-HiFi-5-HiC-Pro/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/denovo-III/" rel="tag"># denovo-III</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2022/03/06/2022-03-06-Linux-grid/" rel="prev" title="【Linux集群任务调度系统】【LSF/SGE/Slurm/PBS】【grid】">
      <i class="fa fa-chevron-left"></i> 【Linux集群任务调度系统】【LSF/SGE/Slurm/PBS】【grid】
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HiC%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">HiC简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#HiC%E5%B8%B8%E8%A7%84%E8%BD%AF%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">HiC常规软件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B"><span class="nav-number">2.</span> <span class="nav-text">案例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HiC-Pro-install"><span class="nav-number">3.</span> <span class="nav-text">HiC-Pro install</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HiC-Pro-GitHub"><span class="nav-number">4.</span> <span class="nav-text">HiC-Pro-GitHub</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#HiC-Pro-annotation-files"><span class="nav-number">4.1.</span> <span class="nav-text">HiC-Pro annotation files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#config-editing"><span class="nav-number">4.2.</span> <span class="nav-text">config editing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#test"><span class="nav-number">4.3.</span> <span class="nav-text">test</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HIC-PRO%E2%80%99S-DOC"><span class="nav-number">5.</span> <span class="nav-text">HIC-PRO’S DOC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E6%AD%A5%E5%8E%9F%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">分步原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Reads-Mapping"><span class="nav-number">6.1.</span> <span class="nav-text">1.Reads Mapping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%89%87%E6%AE%B5%E5%88%86%E9%85%8D%E5%92%8C%E8%BF%87%E6%BB%A4"><span class="nav-number">6.2.</span> <span class="nav-text">2. 片段分配和过滤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-mapping-combine-log"><span class="nav-number">6.3.</span> <span class="nav-text">3. mapping_combine.log</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81merge"><span class="nav-number">6.4.</span> <span class="nav-text">4、merge</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E5%88%A9%E7%94%A8HiCPro%E7%9A%84mapped-2hic-fragments-py%E7%A8%8B%E5%BA%8F%E5%B0%86%E6%AF%94%E5%AF%B9%E7%BB%93%E6%9E%9C%E8%BD%AC%E5%8C%96%E4%B8%BAHi-C%E7%89%87%E6%AE%B5%E4%BF%A1%E6%81%AF"><span class="nav-number">6.5.</span> <span class="nav-text">5、利用HiCPro的mapped_2hic_fragments.py程序将比对结果转化为Hi-C片段信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%AF%B9%E6%89%80%E6%9C%89%E7%9A%84valid-pairs%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6"><span class="nav-number">6.6.</span> <span class="nav-text">6 对所有的valid pairs进行合并</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HiC-Pro-%E8%BE%93%E5%87%BA"><span class="nav-number">7.</span> <span class="nav-text">HiC-Pro 输出</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">8.</span> <span class="nav-text">可视化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Error-debug"><span class="nav-number">9.</span> <span class="nav-text">Error debug</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wang C"
      src="/blog/images/banner.png">
  <p class="site-author-name" itemprop="name">Wang C</p>
  <div class="site-description" itemprop="description">Make more time</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangc1106" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangc1106" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangchen116@126.com" title="E-Mail → mailto:wangchen116@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fas fa-dna"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang C</span>
</div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"UqIYufmNk2sE8MiBKKWc4Kja-gzGzoHsz","app_key":"iYpeWQcmNqpHwr2uVlnJYVji","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
      <div style="height: 200px">
      <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5knf34gs07t&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"></script>
      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
